<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Treasure Box Zone</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FF6B00',
            secondary: '#FF9E00',
            success: '#4CAF50',
            gray: {
              light: '#F5F5F5',
              medium: '#E0E0E0',
              dark: '#9E9E9E'
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'dot-pulse': 'dot-pulse 1.5s infinite',
            'open-box': 'open-box 1.5s forwards',
            'fade-in': 'fade-in 0.5s forwards',
            'slide-up': 'slide-up 0.5s forwards',
            'zoom-in': 'zoom-in 0.5s forwards',
          },
          keyframes: {
            'dot-pulse': {
              '0%, 100%': { opacity: 0.2 },
              '50%': { opacity: 1 },
            },
            'open-box': {
              '0%': { transform: 'scaleY(0.8) translateY(20px)' },
              '50%': { transform: 'scaleY(1.1) translateY(-10px)' },
              '100%': { transform: 'scaleY(1) translateY(0)' },
            },
            'fade-in': {
              '0%': { opacity: 0 },
              '100%': { opacity: 1 },
            },
            'slide-up': {
              '0%': { transform: 'translateY(20px)', opacity: 0 },
              '100%': { transform: 'translateY(0)', opacity: 1 },
            },
            'zoom-in': {
              '0%': { transform: 'scale(0.8)', opacity: 0 },
              '100%': { transform: 'scale(1)', opacity: 1 },
            }
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .countdown-timer {
        letter-spacing: 2px;
      }
      .dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #333;
        margin: 0 2px;
      }
      .dot-1 {
        animation-delay: 0s;
      }
      .dot-2 {
        animation-delay: 0.2s;
      }
      .dot-3 {
        animation-delay: 0.4s;
      }
      .badge {
        position: absolute;
        top: -10px;
        left: -10px;
        transform: rotate(-15deg);
        z-index: 10;
      }
      .winner-badge-container {
        cursor: pointer;
        transition: all 0.2s;
      }
      .winner-badge-container:hover {
        background-color: #e8f5e9;
      }
    }
  </style>
</head>
<body class="bg-gray-light min-h-screen font-sans text-gray-800">
  <!-- 页面容器 -->
  <div id="app" class="max-w-md mx-auto px-4 py-6">
    <!-- 标题栏 -->
    <header class="flex justify-between items-center mb-6">
      <h1 id="pageTitle" class="text-2xl font-bold text-center flex-grow">Treasure Box Zone</h1>
      <button id="myParticipationBtn" class="text-primary text-sm font-medium">My Participations</button>
    </header>

    <!-- 抽奖次数提示 -->
    <div class="bg-white rounded-lg p-3 mb-4 text-center text-sm">
      Today's remaining draws: <span id="remainingDraws" class="font-bold text-primary">3</span>/3
    </div>

    <!-- 主页面 - 宝箱专区 -->
    <main id="treasureBoxPage" class="block">
      <!-- 商品列表 -->
      <div class="grid grid-cols-1 gap-4">
        <!-- 商品1 -->
        <div class="bg-white rounded-xl p-4 card-shadow">
          <div class="relative">
            <img src="https://p11-doubao-search-sign.byteimg.com/labis/image/84e2f2dbad524a0c4eaca29e4c72abf1~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=5Z4SGQAwODf1j1mGrP86DQZIGDo%3D" alt="iPhone 17 Pro Max" class="w-full h-48 object-contain mb-3">
            <!-- 已中奖标签 -->
            <div class="winner-badge badge hidden">
              <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-0004/6b84434aa8e43968692353299e331f~tplv-0-imagecrop_606x606:404x404.image?lk3s=f89d68d&x-expires=1763544123&x-signature=V2%2F8J6V6V5E7L1Q2tL%2BZ6zJz8p8%3D" alt="Won" class="w-20 h-20">
            </div>
          </div>
          <h3 class="font-medium mb-1">[iPhone 17 Pro Max] New flagship! Participate now for a chance to win for free!</h3>
          <div class="flex justify-between items-center mb-3">
            <span class="text-gray-dark text-sm"><span id="participant-count-1">45678</span> participants</span>
            <div class="flex items-center">
              <span class="text-primary font-bold text-lg">$0</span>
              <span class="text-gray-dark text-xs line-through ml-1">$704</span>
            </div>
          </div>
          <button data-id="1" class="participate-btn w-full py-2 bg-primary text-white rounded-lg font-medium transition-all hover:bg-secondary active:scale-95">
            Free Draw
          </button>
        </div>

        <!-- 商品2 -->
        <div class="bg-white rounded-xl p-4 card-shadow">
          <div class="relative">
            <img src="https://p26-doubao-search-sign.byteimg.com/pgc-image/845bc0fa421d4a24b67dc41348f91766~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862262&x-signature=JcTePG5lgj4DxjuJQ9B0ZRNZIT8%3D" alt="MacBook Air M14" class="w-full h-48 object-contain mb-3">
            <!-- 已中奖标签 -->
            <div class="winner-badge badge hidden">
              <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-0004/6b84434aa8e43968692353299e331f~tplv-0-imagecrop_606x606:404x404.image?lk3s=f89d68d&x-expires=1763544123&x-signature=V2%2F8J6V6V5E7L1Q2tL%2BZ6zJz8p8%3D" alt="Won" class="w-20 h-20">
            </div>
          </div>
          <h3 class="font-medium mb-1">[MacBook Air M14] Lightweight performance monster! Elegantly launched!</h3>
          <div class="flex justify-between items-center mb-3">
            <span class="text-gray-dark text-sm"><span id="participant-count-2">18654</span> participants</span>
            <div class="flex items-center">
              <span class="text-primary font-bold text-lg">$0</span>
              <span class="text-gray-dark text-xs line-through ml-1">$617</span>
            </div>
          </div>
          <button data-id="2" class="participate-btn w-full py-2 bg-primary text-white rounded-lg font-medium transition-all hover:bg-secondary active:scale-95">
            Free Draw
          </button>
        </div>

        <!-- 商品3 -->
        <div class="bg-white rounded-xl p-4 card-shadow">
          <div class="relative">
            <img src="https://p11-doubao-search-sign.byteimg.com/labis/06a7c8bcbf822b79a42e36ae2d7fb1d3~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=l90lQWmyExNqOFAScN5xSVYQF8g%3D" alt="LV Neverfull Handbag" class="w-full h-48 object-contain mb-3">
            <!-- 已中奖标签 -->
            <div class="winner-badge badge hidden">
              <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-0004/6b84434aa8e43968692353299e331f~tplv-0-imagecrop_606x606:404x404.image?lk3s=f89d68d&x-expires=1763544123&x-signature=V2%2F8J6V6V5E7L1Q2tL%2BZ6zJz8p8%3D" alt="Won" class="w-20 h-20">
            </div>
          </div>
          <h3 class="font-medium mb-1">[LV Neverfull MM Bag] Classic monogram, large capacity, pursue extraordinary grace</h3>
          <div class="flex justify-between items-center mb-3">
            <span class="text-gray-dark text-sm"><span id="participant-count-3">35234</span> participants</span>
            <div class="flex items-center">
              <span class="text-primary font-bold text-lg">$0</span>
              <span class="text-gray-dark text-xs line-through ml-1">$1090</span>
            </div>
          </div>
          <button data-id="3" class="participate-btn w-full py-2 bg-primary text-white rounded-lg font-medium transition-all hover:bg-secondary active:scale-95">
            Free Draw
          </button>
        </div>

        <!-- 商品4 -->
        <div class="bg-white rounded-xl p-4 card-shadow">
          <div class="relative">
            <img src="https://p11-doubao-search-sign.byteimg.com/tos-cn-i-qvj2lq49k0/297adad3d1d14eccb315c33b5dcc637a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=hzcykICkscExv1fYVVh2sCM3PbA%3D" alt="HUAWEI Mate XT3" class="w-full h-48 object-contain mb-3">
            <!-- 已中奖标签 -->
            <div class="winner-badge badge hidden">
              <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-0004/6b84434aa8e43968692353299e331f~tplv-0-imagecrop_606x606:404x404.image?lk3s=f89d68d&x-expires=1763544123&x-signature=V2%2F8J6V6V5E7L1Q2tL%2BZ6zJz8p8%3D" alt="Won" class="w-20 h-20">
            </div>
          </div>
          <h3 class="font-medium mb-1">[HUAWEI Mate XT3] Tri-fold screen large smartphone, take it home for $0!</h3>
          <div class="flex justify-between items-center mb-3">
            <span class="text-gray-dark text-sm"><span id="participant-count-4">58864</span> participants</span>
            <div class="flex items-center">
              <span class="text-primary font-bold text-lg">$0</span>
              <span class="text-gray-dark text-xs line-through ml-1">$704</span>
            </div>
          </div>
          <button data-id="4" class="participate-btn w-full py-2 bg-primary text-white rounded-lg font-medium transition-all hover:bg-secondary active:scale-95">
            Free Draw
          </button>
        </div>
      </div>
    </main>

    <!-- 我的参与页面 -->
    <main id="myParticipationPage" class="hidden">
      <div class="flex justify-start items-center mb-4">
        <button id="backToTreasureBtn" class="text-primary text-sm font-medium flex items-center">
          <i class="fa fa-arrow-left mr-1"></i> Back
        </button>
      </div>

      <div id="participationList" class="grid grid-cols-1 gap-4">
        <!-- 我的参与列表将通过JavaScript动态生成 -->
        <div class="text-center py-8 text-gray-dark" id="emptyParticipation">
          <p>You haven't participated in any draws yet</p>
        </div>
      </div>
    </main>

    <!-- 开宝箱弹窗 -->
    <div id="openBoxModal" class="fixed inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50 hidden">
      <div class="text-center w-5/6 max-w-sm">
        <!-- 商品图片 -->
        <div id="productImageContainer" class="relative w-64 h-64 mx-auto mb-4 animate-zoom-in">
          <img id="drawProductImage" src="https://p11-doubao-search-sign.byteimg.com/labis/image/84e2f2dbad524a0c4eaca29e4c72abf1~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=5Z4SGQAwODf1j1mGrP86DQZIGDo%3D" alt="Product image" class="w-full h-full object-contain">
          <div id="boxOpening" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full">
            <div class="text-white text-xl font-medium">
              Drawing<span class="inline-flex ml-1">
                <span class="dot dot-1 animate-dot-pulse"></span>
                <span class="dot dot-2 animate-dot-pulse"></span>
                <span class="dot dot-3 animate-dot-pulse"></span>
              </span>
            </div>
          </div>
        </div>
        
        <!-- 商品名称 -->
        <p id="prizeName" class="text-white text-xl mb-6 font-bold">【iPhone 17 Pro Max】</p>
        
        <!-- 未中奖结果 -->
        <div id="notWinResult" class="hidden animate-fade-in">
          <div class="bg-white bg-opacity-90 rounded-2xl p-6 mb-6">
            <div class="flex justify-center mb-4">
              <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center">
                <i class="fa fa-times text-red-500 text-3xl"></i>
              </div>
            </div>
            <h3 class="text-xl font-bold text-center mb-2">Sorry, you didn't win</h3>
            <p class="text-gray-dark text-center">Continue participating in other draws, good luck is waiting for you!</p>
          </div>
          <button id="closeBoxModal" class="py-3 px-10 bg-primary text-white rounded-lg font-medium transition-all hover:bg-secondary active:scale-95 text-lg">
            Close
          </button>
        </div>
        
        <!-- 优惠券中奖结果 -->
        <div id="couponWinResult" class="hidden animate-fade-in">
          <div class="bg-white bg-opacity-90 rounded-2xl p-6 mb-6 relative">
            <!-- 关闭按钮 -->
            <button id="closeCouponIcon" class="absolute top-4 right-4 text-gray-dark hover:text-gray-800 transition-colors">
              <i class="fa fa-times text-xl"></i>
            </button>
            
            <div class="flex justify-center mb-4">
              <div class="w-20 h-20 bg-success/20 rounded-full flex items-center justify-center">
                <i class="fa fa-ticket text-success text-3xl"></i>
              </div>
            </div>
            <h3 class="text-xl font-bold text-center mb-2 text-success">Surprise! Although you didn't win this product, you got an unexpected reward</h3>
            <p class="text-center font-medium mb-4">$7 ok.com platform coupon</p>
            <p class="text-gray-dark text-center mb-4">Please open WhatsApp and add the following account to claim:</p>
            <p class="text-center font-bold mb-6 flex items-center justify-center">
              971509216685
              <button class="copy-btn ml-2 text-gray-dark hover:text-primary transition-colors" data-clipboard-text="971509216685">
                <i class="fa fa-copy"></i>
              </button>
            </p>
            <a href="https://wa.me/971509216685" target="_blank" class="block text-center py-2 bg-success text-white rounded-lg font-medium transition-all hover:bg-success/80 active:scale-95 mb-3">
              <i class="fa fa-whatsapp mr-2"></i>Open WhatsApp
            </a>
          </div>
          <button id="closeCouponModal" class="py-3 px-10 bg-primary text-white rounded-lg font-medium transition-all hover:bg-secondary active:scale-95 text-lg">
            Added
          </button>
        </div>
      </div>
    </div>

    <!-- 我的参与页面的优惠券浮层 -->
    <div id="participationCouponModal" class="fixed inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50 hidden">
      <div class="text-center w-5/6 max-w-sm">
        <div class="bg-white bg-opacity-90 rounded-2xl p-6 relative">
          <!-- 关闭按钮 -->
          <button id="closeParticipationCoupon" class="absolute top-4 right-4 text-gray-dark hover:text-gray-800 transition-colors">
            <i class="fa fa-times text-xl"></i>
          </button>
          
          <div class="flex justify-center mb-4">
            <div class="w-20 h-20 bg-success/20 rounded-full flex items-center justify-center">
              <i class="fa fa-ticket text-success text-3xl"></i>
            </div>
          </div>
          <h3 class="text-xl font-bold text-center mb-2 text-success">Surprise! Although you didn't win this product, you got an unexpected reward</h3>
          <p class="text-center font-medium mb-4">$7 ok.com platform coupon</p>
          <p class="text-gray-dark text-center mb-4">Please open WhatsApp and add the following account to claim:</p>
          <p class="text-center font-bold mb-6 flex items-center justify-center">
            971509216685
            <button class="copy-btn ml-2 text-gray-dark hover:text-primary transition-colors" data-clipboard-text="971509216685">
              <i class="fa fa-copy"></i>
            </button>
          </p>
          <a href="https://wa.me/971509216685" target="_blank" class="block text-center py-2 bg-success text-white rounded-lg font-medium transition-all hover:bg-success/80 active:scale-95 mb-3">
            <i class="fa fa-whatsapp mr-2"></i>Open WhatsApp
          </a>
        </div>
      </div>
    </div>

    <!-- 抽奖次数上限提示 -->
    <div id="limitToast" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg text-sm hidden animate-fade-in">
      Only 3 chances per day~
    </div>
  </div>

  <script>
    // 格式化日期函数
    function formatDate(dateString) {
      const date = new Date(dateString);
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    // 汇率设置 (1人民币 = 0.138美元)
    const EXCHANGE_RATE = 0.138;
    
    // 模拟数据
    const products = [
      {
        id: 1,
        name: 'iPhone 17 Pro Max',
        description: '[iPhone 17 Pro Max] New flagship! Participate now for a chance to win for free!',
        image: 'https://p11-doubao-search-sign.byteimg.com/labis/image/84e2f2dbad524a0c4eaca29e4c72abf1~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=5Z4SGQAwODf1j1mGrP86DQZIGDo%3D',
        originalPrice: 5099,
        participantCount: 45678,
        usdPrice: (5099 * EXCHANGE_RATE).toFixed(0)
      },
      {
        id: 2,
        name: 'MacBook Air M14',
        description: '[MacBook Air M14] Lightweight performance monster! Elegantly launched!',
        image: 'https://p26-doubao-search-sign.byteimg.com/pgc-image/845bc0fa421d4a24b67dc41348f91766~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862262&x-signature=JcTePG5lgj4DxjuJQ9B0ZRNZIT8%3D',
        originalPrice: 4499,
        participantCount: 18654,
        usdPrice: (4499 * EXCHANGE_RATE).toFixed(0)
      },
      {
        id: 3,
        name: 'LV Neverfull MM Bag',
        description: '[LV Neverfull MM Bag] Classic monogram, large capacity, pursue extraordinary grace',
        image: 'https://p11-doubao-search-sign.byteimg.com/labis/06a7c8bcbf822b79a42e36ae2d7fb1d3~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=l90lQWmyExNqOFAScN5xSVYQF8g%3D',
        originalPrice: 7900,
        participantCount: 35234,
        usdPrice: (7900 * EXCHANGE_RATE).toFixed(0)
      },
      {
        id: 4,
        name: 'HUAWEI Mate XT3',
        description: '[HUAWEI Mate XT3] Tri-fold screen large smartphone, take it home for $0!',
        image: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-qvj2lq49k0/297adad3d1d14eccb315c33b5dcc637a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1777862715&x-signature=hzcykICkscExv1fYVVh2sCM3PbA%3D',
        originalPrice: 5099,
        participantCount: 58864,
        usdPrice: (5099 * EXCHANGE_RATE).toFixed(0)
      }
    ];

    // 用户参与数据
    let userParticipations = JSON.parse(localStorage.getItem('userParticipations')) || [];
    let dailyParticipationCount = JSON.parse(localStorage.getItem('dailyParticipationCount')) || 0;
    let lastParticipationDate = localStorage.getItem('lastParticipationDate') || '';
    let hasWonCoupon = JSON.parse(localStorage.getItem('hasWonCoupon')) || false;

    // 检查是否跨天，重置每日参与次数和优惠券中奖状态
    const today = new Date().toDateString();
    if (lastParticipationDate !== today) {
      dailyParticipationCount = 0;
      lastParticipationDate = today;
      hasWonCoupon = false;
      localStorage.setItem('dailyParticipationCount', JSON.stringify(dailyParticipationCount));
      localStorage.setItem('lastParticipationDate', lastParticipationDate);
      localStorage.setItem('hasWonCoupon', JSON.stringify(hasWonCoupon));
    }

    // 更新剩余抽奖次数显示
    function updateRemainingDraws() {
      const remaining = 3 - dailyParticipationCount;
      document.getElementById('remainingDraws').textContent = remaining;
    }

    // DOM元素
    const treasureBoxPage = document.getElementById('treasureBoxPage');
    const myParticipationPage = document.getElementById('myParticipationPage');
    const myParticipationBtn = document.getElementById('myParticipationBtn');
    const backToTreasureBtn = document.getElementById('backToTreasureBtn');
    const participateBtns = document.querySelectorAll('.participate-btn');
    const openBoxModal = document.getElementById('openBoxModal');
    const drawProductImage = document.getElementById('drawProductImage');
    const boxOpening = document.getElementById('boxOpening');
    const notWinResult = document.getElementById('notWinResult');
    const couponWinResult = document.getElementById('couponWinResult');
    const closeBoxModal = document.getElementById('closeBoxModal');
    const closeCouponModal = document.getElementById('closeCouponModal');
    const closeCouponIcon = document.getElementById('closeCouponIcon');
    const prizeName = document.getElementById('prizeName');
    const limitToast = document.getElementById('limitToast');
    const participationList = document.getElementById('participationList');
    const emptyParticipation = document.getElementById('emptyParticipation');
    const participationCouponModal = document.getElementById('participationCouponModal');
    const closeParticipationCoupon = document.getElementById('closeParticipationCoupon');

    // 页面切换
    myParticipationBtn.addEventListener('click', () => {
      treasureBoxPage.classList.add('hidden');
      myParticipationPage.classList.remove('hidden');
      renderParticipationList();
    });

    backToTreasureBtn.addEventListener('click', () => {
      myParticipationPage.classList.add('hidden');
      treasureBoxPage.classList.remove('hidden');
    });

    // 参与抽奖
    participateBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // 检查该商品是否已参与
        const productId = parseInt(btn.dataset.id);
        const alreadyParticipated = userParticipations.some(p => p.productId === productId);
        
        if (alreadyParticipated) {
          // 已参与该商品，不执行任何操作
          return;
        }
        
        // 检查每日参与次数
        if (dailyParticipationCount >= 3) {
          showToast(limitToast);
          return;
        }
        
        const product = products.find(p => p.id === productId);
        
        // 增加参与次数
        dailyParticipationCount++;
        localStorage.setItem('dailyParticipationCount', JSON.stringify(dailyParticipationCount));
        updateRemainingDraws(); // 更新剩余次数显示
        
        // 更新参与人数
        product.participantCount++;
        document.getElementById(`participant-count-${productId}`).textContent = product.participantCount.toLocaleString();
        
        // 添加到我的参与
        const participation = {
          productId,
          productName: product.name,
          productImage: product.image,
          participateTime: new Date(),
          isWinner: false // 默认未中奖
        };
        
        // 首次抽奖必中优惠券
        if (!hasWonCoupon) {
          participation.isWinner = true;
          hasWonCoupon = true;
          localStorage.setItem('hasWonCoupon', JSON.stringify(hasWonCoupon));
          
          // 显示已中奖标签
          const badge = btn.closest('.bg-white.rounded-xl.p-4.card-shadow').querySelector('.winner-badge');
          badge.classList.remove('hidden');
        }
        
        userParticipations.push(participation);
        localStorage.setItem('userParticipations', JSON.stringify(userParticipations));
        
        // 更新按钮状态
        btn.textContent = 'Participated';
        btn.classList.remove('bg-primary', 'hover:bg-secondary');
        btn.classList.add('bg-gray-medium', 'cursor-not-allowed');
        
        // 显示开奖弹窗
        openDrawModal(product, participation.isWinner);
      });
    });

    // 关闭未中奖弹窗
    closeBoxModal.addEventListener('click', () => {
      openBoxModal.classList.add('hidden');
      resetDrawModal();
    });

    // 关闭优惠券中奖弹窗（按钮）
    closeCouponModal.addEventListener('click', () => {
      openBoxModal.classList.add('hidden');
      resetDrawModal();
    });

    // 关闭优惠券中奖弹窗（图标）
    closeCouponIcon.addEventListener('click', () => {
      openBoxModal.classList.add('hidden');
      resetDrawModal();
    });

    // 关闭我的参与页面的优惠券浮层
    closeParticipationCoupon.addEventListener('click', () => {
      participationCouponModal.classList.add('hidden');
    });

    // 显示提示
    function showToast(toastEl) {
      toastEl.classList.remove('hidden');
      setTimeout(() => {
        toastEl.classList.add('hidden');
      }, 1500);
    }

    // 打开抽奖弹窗
    function openDrawModal(product, isCouponWinner) {
      drawProductImage.src = product.image;
      prizeName.textContent = `【${product.name}】`;
      openBoxModal.classList.remove('hidden');
      
      // 1.5秒后显示结果
      setTimeout(() => {
        boxOpening.classList.add('hidden');
        if (isCouponWinner) {
          couponWinResult.classList.remove('hidden');
        } else {
          notWinResult.classList.remove('hidden');
        }
      }, 1500);
    }

    // 重置抽奖弹窗
    function resetDrawModal() {
      boxOpening.classList.remove('hidden');
      notWinResult.classList.add('hidden');
      couponWinResult.classList.add('hidden');
    }

    // 渲染我的参与列表
    function renderParticipationList() {
      // 清空列表
      participationList.innerHTML = '';
      
      // 检查是否有参与记录
      if (userParticipations.length === 0) {
        emptyParticipation.classList.remove('hidden');
        return;
      }
      
      emptyParticipation.classList.add('hidden');
      
      // 排序：最新的在前
      const sortedParticipations = [...userParticipations].sort((a, b) => {
        return new Date(b.participateTime) - new Date(a.participateTime);
      });
      
      // 创建列表项
      sortedParticipations.forEach(participation => {
        const product = products.find(p => p.id === participation.productId);
        if (!product) return;
        
        const participationItem = document.createElement('div');
        participationItem.className = 'bg-white rounded-xl p-4 card-shadow';
        participationItem.innerHTML = `
          <div class="relative">
            ${participation.isWinner ? `
              <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-0004/6b84434aa8e43968692353299e331f~tplv-0-imagecrop_606x606:404x404.image?lk3s=f89d68d&x-expires=1763544123&x-signature=V2%2F8J6V6V5E7L1Q2tL%2BZ6zJz8p8%3D" alt="Won" class="w-20 h-20 badge">
            ` : ''}
            <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-contain mb-3">
          </div>
          <h3 class="font-medium mb-1">${product.description}</h3>
          <div class="flex justify-between items-center mb-3">
            <span class="text-gray-dark text-sm">${formatDate(participation.participateTime)}</span>
            ${participation.isWinner ? `
              <span class="px-2 py-1 bg-success/10 text-success text-xs rounded-full cursor-pointer winner-badge-container" data-id="${participation.productId}">
                View Prize
              </span>
            ` : `
              <span class="px-2 py-1 bg-gray-100 text-gray-dark text-xs rounded-full">
                Not Won
              </span>
            `}
          </div>
        `;
        
        participationList.appendChild(participationItem);
        
        // 添加中奖记录的点击事件
        if (participation.isWinner) {
          const winnerBadge = participationItem.querySelector('.winner-badge-container');
          winnerBadge.addEventListener('click', () => {
            participationCouponModal.classList.remove('hidden');
          });
        }
      });
    }

    // 添加复制功能
    document.addEventListener('click', function(e) {
      if (e.target.closest('.copy-btn')) {
        const btn = e.target.closest('.copy-btn');
        const text = btn.getAttribute('data-clipboard-text');
        
        // 复制到剪贴板
        navigator.clipboard.writeText(text).then(() => {
          // 显示复制成功提示
          const originalIcon = btn.innerHTML;
          btn.innerHTML = '<i class="fa fa-check"></i>';
          btn.classList.add('text-success');
          
          // 2秒后恢复原始图标
          setTimeout(() => {
            btn.innerHTML = originalIcon;
            btn.classList.remove('text-success');
          }, 2000);
        });
      }
    });

    // 初始化页面
    updateRemainingDraws();
  </script>
</body>
</html>
